# 2. User behavior and how to collect it
## 단원 목표
- Netflix에서 **events**를 식별하고, 어떤 것을 통해 유저의 취향을 파악할 수 있는지 알아본다.
- events를 수집하는 **collector**를 어떻게 만드는지 알아본다.
- collector를 MovieGEEKs에 통합하여 어떻게 하면 Netflix처럼 events를 모으는지 알아본다.
- 소비자의 행동을 분석한다.

##
- **Evidence**: 고객의 취향이 드러나는 데이터. 고객의 행동(behavior)과 그로 인해 발생하는 사건(events)이 evidence에 해당한다.
- 유효한 Evidence를 어떻게 수집할 것인가에 대해 깊게 고민해봐야 한다. 
	- 어떤 추천 시스템에서 중요한 evidence로 역할을 했더라도 다른 추천 시스템에서는 쓸모없는 evidence일 수 있기 때문
	- 이 책에서는 실무에서 추천 시스템을 직접 설계할 때 데이터 수집에 도움이 되도록 다양한 예시를 보여준다.
- 일반적으로 고객에 의해 생성되는 데이터는 두 가지이다.
	- explicit: ratings or likes
		- 고객의 취향을 파악하기 위한 evidence로 사람들이 가장 먼저 떠올리는 것
	- implicit: activity recorded by monitoring the user

# 2.1 How (I think) Netflix gathers evidence while you browse
- Netflix의 landing page는 top row를 제외하고는 모두 개인화되어 있다. 즉, top row를 제외한 행들은 유저마다 다르다.
- 추천 목록에 마우스를 올리면 오른쪽으로 스크롤을  해 다른 추천 상품들도 볼 수 있다.
- 특정 상품이 내 관심을 끈다면 마우스를 올려 자세한 설명을 볼 수 있다.
- 더욱 관심을 끈다면 해당 상품을 클릭해 상품 페이지로 이동할 수 있다.
- 나중에 상품을 소비할 생각이 들었다면 '나중에 보기' 목록에 넣어둘 수 있다.
- e-commerce에서 상품을 소비하는 것과 netflix에서 영화를 시청하는 것은 같은 의미를 가지는 것 처럼 보인다. 하지만 영화를 시청한지 얼마 안되서 시청을 종료하면 이것은 좋지 않은 신호이다. ( 이벤트를 너무 단편적으로 생각하면 안된다는 뜻인듯 )

### OFTEN THE PURPOSE ISN’T WHAT IT SEEMS
e-commerce의 목적은 고객들이 상품을 사도록 하는 것이다. 비록 고객이 구매하는 제품이 정확히 그들이 원하는 것이 아닐지라도 말이다. 하지만 그것은 사이트마다 다르다. 예를 들어 아마존에서 품질이 좋지 않은 티셔츠를 판매한다면 티셔츠 브랜드가 나쁘다고 할 수 있지만 아마존으로 돌아가서 다른 티셔츠를 살 것이다. 하지만 GAP 웹사이트에서 티셔츠를 구매했는데 품질이 마음에 들지 않았다면 GAP이라는 브랜드 자체를 이탈하게 될 것이다.

## 2.1.1 The evidence Netflix collects
- Jimmie ( ID: 1234 )라는 고객이 Netflix에서 다음과 같은 행동을 했다고 하자.
	1. Scrolls the Drama ( ID: 2 ) row
	2. Hovers the mouse over a movie ( ID: 41335 ) to get details
	3. Clicks to get more details about the movie ( ID: 41335 )
	4. Starts watching the movie ( ID: 41335 )
- Netflix에서 수집하는 Evidence는 다음과 같다고 하자.
![image](https://user-images.githubusercontent.com/85201805/127278369-6fd6ff95-51bf-4c5e-b740-f9a6f8200d13.png)
- 그렇다면 Jimmie가 한 행동은 Netflix의 DB에 다음과 같이 기록된다.![image](https://user-images.githubusercontent.com/85201805/127278486-f0b32cdf-6d10-497f-879f-51caf04754d1.png)
- 이것 말고도 device type, location, speed, weather와 같이 고객의 context를 파악할 수 있는 칼럼을 더 추가할 수 있다.
- 또한 Event의 종류도 더 다양할 수 있다.

## 
- 우리는 Evidence가 어떤 것인지에 대한 감을 잡았다. 이제는 **evidence collector**를 어떻게 도입할 지에 대한 것을 배운다.
- evidence collector는 Table 2.2와 같은 내용을 수집하기 위한 것이다.

# 2.2 Finding useful user behavior
- 고객이 상품과 관련하여 하는 행동은 모두 수집하는 것이 가장 이상적이다.

## 2.2.1 Capturing visitor impressions
- To better illustrate the events that occur in the lifetime of a consumer/product relationship, I’ve divided it into the following steps
	1. 고객이 쇼핑몰을 탐색
	2. 고객이 특정 상품에 대해 관심을 보이기 시작함
	3. 고객이 상품을 장바구니에 담거나 상품에 좋아요를 누름
	4. 고객이 상품을 구매함
	5. 고객이 상품을 소비함
		- 식재료를 구매한 경우 소비는 식재료 먹기를 의미
		- 영화를 구매한 경우 소비는 영화 시청을 의미
	6. 고객이 상품에 대해 평점을 매김
	7. 종료
- 각 단계에서 어떤 것을 수집할 지는 나중에 다룸
- explicit feedback은 6단계가 되어야 등장한다는 것을 기억해야 한다. 이것은 life cycle의 후반부에 위치한 것으로 데이터를 수집하기에는 늦은 시점이다. 그 이전부터 implicit feedback을 수집해 추천 시스템에 반영해야 한다.

## 2.2.2 What you can learn from a shop browser
- browser: 돌아다니면서 상품을 보는 고객
- browser가 어디서 멈춰서 살펴보는지 알아야 한다. 반대로 전혀 관심을 보이지 않는 것은 어떤 것인지도 알아야 한다.

### page view
- e-commerce에서 page view는 여러 가지를 의미할 수 있다.
	- 고객이 해당 상품에 관심을 보이는 것
	- 고객이 돌아다니다가 길을 잃어 들어오게 된 것
	- 아무거나 클릭해서 들어오게 된 것
- 즉, page view라고 모두 긍정적으로 볼 수는 없다는 것이다.
- 실제로 이탈고객들은 많은 page view를 보였지만 conversion은 발생하지 않았다.
- 좋은 추천 시스템은 고객이 일일이 둘러보기 전에 추천을 통해 모든 상품을 찾게하기 때문에 page view가 줄어든다.

### page duration
- 고객에 상품 페이지에 방문했을 때 실제로 관심이 있는지 파악하기 위해 몇 초 동안이나 상품 페이지에 머물러 있는지를 알아야 한다.
- 고객이 머물렀던 시간이 뜻하는 바를 표로 정리한 것이다.
![image](https://user-images.githubusercontent.com/85201805/127409048-88dfe5a8-1813-456a-8a96-65167519200a.png)
- 대부분의 경우에 이 것이 맞지만, 도메인에 맞게 수정해 적용하면 된다.

### expansion clicks
- 상품에 대한 고객의 관심을 파악할 방법이 더 있다.
- 상품 페이지에 '자세히 보기' 버튼을 만들어 그 버튼을 클릭하면 상품에 대한 원산지, 재료 등 자세한 정보가 나오게 하는 것이다.
![image](https://user-images.githubusercontent.com/85201805/127409888-a4e9a96f-d258-4afe-964c-b4f1ccdd4d9d.png)

### social media links
- 고객이 social media button을 눌러서 상품을 다른 사람들과 공유한다면 그것은 고객이 해당 상품을 좋아한다는 뜻이다.

### search terms
- 고객은 자신이 원하는 것을 빠르게 찾기를 원한다. 이 때 주로 사용하는 검색이다.
- 검색어를 통해 고객이 원하는 것을 파악할 수 있다.
- 참고
	- Netflix에서는 만약 고객이 wonder woman을 검색했을 때wonder woman이라는 영화가 Netflix 카탈로그에 등록되어 있지 않더라도 비슷한 제목을 가진 영화를 결과로 보여준다.
	- Netflix는 고객이 검색하는 행위를 추천의 실패로 봄 (고객의 구매욕을 추천 시스템이 충족시켜주지 못했기 때문에 검색을 한다고 봄)
	- 고객이 검색한 검색어와 그가 소비한 상품을 함께 고려하여 추천 시스템을 만들 수도 있다.

## 2.2.3 Act of buying
- 고객이 특정 상품을 구매한다는 것은 고객이 그 상품을 유용하다고 생각하거나 좋아한다는 뜻이다.
- 하지만 선물용으로 구매한 것일 수도 있다.
	- 자신을 위해 구매한 것과 선물용으로 구매한 것의 차이를 구분하기는 쉽지 않다. 지금까지 구매했던 것과 다른 결의 상품이라면 그것은 선물이라고 봐야하는데, 이것은  고객의 취향이 새롭게 생긴 것일수도 있기 때문이다.
- 어찌됐던 상품을 구매하는 것은 긍정적인 신호

## 2.2.4 Consuming products
pass

## 2.2.5 Visitor ratings
- 대부분의 웹사이트는 고객이 소비한 상품에 대해 평가를 할 수 있게끔 해놓음
- 평점을 기반으로 고객이 어떤 상품을 좋아하는지 파악할 수 있고, 더 나은 상품을 추천해줄 수 있게 된다.
- 평점과 함께 리뷰도 남길 수 있게 한다. ( 상품에 대한 고객의 생각이 더 자세하게 담김 )

### A sense of control
- 고객은 추천 시스템이 자신의 행동을 바탕으로 추천해준다는 사실을 알고 있으며, 자신이 원하는 추천 결과가 나오도록 평점을 조절하여 추천 시스템을 통제하려고 한다.

### Saving a rating
- 고객이 평점을 매기는 것 또한 event이므로 저장시켜야 한다.

### Negative user ratings
- 부정적인 평점 ( 1점 ) 을 매긴 상품에 대한 선호도는 평가하지 않은 상품 ( 0점 ) 에 대한 선호도보다 못하다.

### Voting
- 어떤 웹사이트들은 유저들이 특정 상품에 대해 좋은지 싫은지 투포하도록 만드는 데 성공했다. 
	- stack overflow, kaggle 등에서도 사용된다.
	- 이런 것을 reputation systems 이라고 한다.

## 2.2.6 Getting to know your customers the (old) Netflix way
pass

# 2.3 Identifying users
- 고객에 대한 데이터를 모으기 위해서는 고객을 구분할 수 있어야 한다.
- 가장 좋은 방법은 고객이 로그인하게끔 하는 것이며, 그 대안으로는 쿠키(cookies)가 있다.
- 웹사이트는 쿠키를 설정하고 모든 정보를 해당 쿠키에 연결하는 것으로 시작
- 고객이 로그인하거나 회원가입을 하여 식별 정보를 제공하는 경우 쿠키의 모든 정보가 해당 계정으로 전송
- 공용 컴퓨터 또는 가족 컴퓨터일 수 있으므로 주의
- 여러 세션에 걸쳐 데이터를 쿠키 ID에 저장하는 것은 오해의 소지가 있다.

# 2.4 Getting visitor data from other sources
pass

# 2.5 The collector
- 이제는 evidence collector를 도입한다.
- 웹사이트의 성능과 신뢰성 때문에 현재 기존 서버에 evidence collector를 추가하지 않는 것이 좋다.
- 대신 evidence collector를 지원하는 병렬 구조에 추가면 된다.
- 이렇게 하면 고객이 추천 시스템을 추가한 후 난동을 부리거나 사이트의 로드가 확장성을 위해 제한에 근접할 경우 evidence collector를 다른 서버로 이동시킬 수 있다.
- evidence collector는 두 부분으로 나눌 수 있다.
	- The server side: 이 예에서 서버 쪽은 엔드포인트로 작동하는 Django web API를 사용하여 구축되며 고객이 접촉하는 모든 것을 대상으로 사용할 수 있다. 서버는 event가 발생했다는 소식을 들으면 그것을 저장하는 역할만 수행한다.
	- The client side: Javascript로 되어있으며, 서버에 있는 evidence collector에 evidence가 발생했다는 것을 posts로 알려준다.

![image](https://user-images.githubusercontent.com/85201805/127428491-abb8f0b8-dff7-4578-9d70-a2278ab827d2.png)

## 2.5.1 Building the project files
## 2.5.2 The data model
- 웹사이트에서 발생하는 대부분의 이벤트를 모아야 한다.
- **userID**, **contentID**, **eventType**, **sessionID**, **date**를 수집해야 한다.
- 더 고도화시키기 위해 device type과 같은 context를 수집할 수 있다.
- sessionID는 각 session을 구분할 수 있어야 한다.

## 2.5.3 The snitch: Client-side evidence collector
- event logger: event collector를 호출하는 간단한 javascript 함수
- snitch: 데이터를 수집하길 원하는 곳에 심어져 있는 것. ( creates an AJAX call to the collector )
![image](https://user-images.githubusercontent.com/85201805/127432620-bb2a5e83-54b2-42a6-929d-63b5dc8040da.png)
- Listing 2.1의 함수에서 걸려온 호출은 다음 목록에 표시된 `/moviegek/disc/view.py의 log` 함수에 의해 수신됩니다.
![image](https://user-images.githubusercontent.com/85201805/127433606-b6da2d4d-bd0a-4b5d-983b-03dd879e98a4.png)

## 2.5.4 Integrating the collector into MovieGEEKs
- MovieGEEKs 는 아래에 있는 예제를 다룬다. 예제는 Netflix의 use case와 유사한 것이다.
![image](https://user-images.githubusercontent.com/85201805/127434121-f033c47c-7d50-40f4-a1b3-ad6a55a18016.png)

### LOGGING GENRE EVENTS
- 다음 event는 템플릿 `templates/moviegeek/base.html` 에 구현되어 있다.
- 가장 먼저 해볼 것은 고객이 좌측에 있는 장르를 선택하는 것이다.![image](https://user-images.githubusercontent.com/85201805/127435936-a8d577b0-3283-4b56-93ec-72b944cf56a9.png)
- 각 장르를 데이터 수집이 가능한 객체로 바꾸기 위해서는 `onclick` attribute를 추가해야 한다. 고객이 장르를 클릭하면 evidence collector에 HTTP POST 요청을 실행한다. 그림으로 표현하면 다음과 같다.
![image](https://user-images.githubusercontent.com/85201805/127436845-409de567-c83b-495f-ab3d-8a1a52e42498.png)
![image](https://user-images.githubusercontent.com/85201805/127437395-8d221572-4ef4-4177-95c4-9c287db856c6.png)

### LOGGING POPOVER EVENTS
pass

### LOGGING MORE DETAILS EVENTS
pass

### LOGGING SAVE FOR LATER
pass

# 2.6 What users in the system are and how to model them
pass